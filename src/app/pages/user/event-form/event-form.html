<div class="event-wrapper">

  <!-- COLUMNA IZQUIERDA: FORMULARIO -->
  <div class="left-column">

    <form [formGroup]="eventForm">  <!-- <- AQUI -->

      <!-- INFORMACIÓN DEL EVENTO -->
      <div class="card section-card">
        <h2 class="section-title"><span>1</span> ¡Crea el evento de tus sueños!</h2>

        <div class="field">
            <label> ¿Que tipo de evento quisieras realizar? </label>

            <select formControlName="eventType">
              <option value="">Seleccionar</option>
              <option *ngFor="let type of eventTypes" [value]="type">{{ type }}</option>
            </select>
          </div>

          <div class="field">
          <label>Cantidad de invitados:</label>
          <label>Pedimos para ser posible su fiesta un minimo de 80 invitados, y por el momento contamos con espacio para un maximo de 200 invitados. </label>
          <input type="number" formControlName="guests" placeholder="Número" min="80" max="200">

          @if(eventForm.get('guests')?.invalid && eventForm.get('guests')?.touched) {
          <div class="error">

            @if (eventForm.get('guests')?.errors?.['required']) {
            <small>Este campo es obligatorio.</small>
            }

            @if (eventForm.get('guests')?.errors?.['min']) {
            <small>El mínimo permitido es 80.</small>
            }

            @if (eventForm.get('guests')?.errors?.['max']) {
            <small>El máximo permitido es 200.</small>
            }

          </div>
          }
        </div>


        <mat-form-field appearance="fill">
  <mat-label>Fecha del evento</mat-label>

  <input
    matInput
    [matDatepicker]="picker"
    formControlName="date"
    [matDatepickerFilter]="fechaDeshabilitada"
  >

  <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
  <mat-datepicker #picker></mat-datepicker>
</mat-form-field>


        <!-- <label>Fecha</label>
        <input type="date" formControlName="date"> -->

        <!-- MENÚ -->
        <label>Menús disponibles</label>
        <div class="options-row">
          <button
            type="button"
            class="option-btn"
            *ngFor="let m of menus()"
            [class.active]="eventForm.value.menuType === m.id"
            (click)="selectMenu(m.id)"
          >
            {{ m.name }} - ${{ m.price }}
          </button>
        </div>

        <!-- DECORACIONES -->
        <label>Decoraciones</label>
        <div class="options-row">
          <button
            type="button"
            class="option-btn"
            *ngFor="let d of decorations()"
            [class.active]="selectedByCategory['decoration'] === d.id"
            (click)="selectDecoration(d.id)"
          >
            {{ d.name }} - ${{ d.price }}
          </button>
        </div>

        <!-- MÚSICA -->
        <label>Música</label>
        <div class="options-row">
          <button
            type="button"
            class="option-btn"
            *ngFor="let m of music()"
            [class.active]="selectedByCategory['music'] === m.id"
            (click)="selectMusic(m.id)"
          >
            {{ m.name }} - ${{ m.price }}
          </button>
        </div>
      </div>

      <!-- EXTRAS -->
      <div class="card section-card">
        <h2 class="section-title"><span>2</span> Adicionales</h2>
        <div class="extras-grid">
          <div class="extra-item" *ngFor="let e of EXTRAS">
            <label>¿Necesitás {{ e.key }}?</label>
            <div class="options-row">
              <button
                type="button"
                class="option-btn"
                [class.active]="eventForm.value.extras?.[e.key] === true"
                (click)="toggleExtra(e.key, true)"
              >
                Sí (+ ${{ e.price }})
              </button>
              <button
                type="button"
                class="option-btn"
                [class.active]="eventForm.value.extras?.[e.key] === false"
                (click)="toggleExtra(e.key, false)"
              >
                No
              </button>
            </div>
          </div>
        </div>
      </div>

      <button type="button" class="submit-btn" (click)="cargarEvento()">Crear evento</button>
    </form> <!-- <- CIERRE FORM -->

  </div>
  <!-- COLUMNA DERECHA: RESUMEN -->
  <div class="right-column">
    <div class="card summary-card">
      <h2 class="summary-title">Resumen</h2>

      <div class="summary-item" *ngFor="let id of eventForm.value.selectedElements">
        <ng-container *ngFor="let e of elements()">
          <ng-container *ngIf="e.id === id">
            <span>{{ e.name }}</span>
            <span>${{ e.price }}</span>
          </ng-container>
        </ng-container>
      </div>

      <!-- Extras -->
      <div class="summary-item" *ngFor="let extra of EXTRAS">
        <ng-container *ngIf="eventForm.value.extras?.[extra.key]">
          <span>{{ extra.key }}</span>
          <span>${{ extra.price }}</span>
        </ng-container>
      </div>

      <hr>

      <div class="summary-total">
        Total: ${{ finalPrice() }}
      </div>

    </div>
  </div>

</div>
